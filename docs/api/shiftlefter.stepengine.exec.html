<!DOCTYPE html PUBLIC ""
    "">
<html><head><meta charset="UTF-8" /><title>shiftlefter.stepengine.exec documentation</title><link rel="stylesheet" type="text/css" href="css/default.css" /><link rel="stylesheet" type="text/css" href="css/highlight.css" /><script type="text/javascript" src="js/highlight.min.js"></script><script type="text/javascript" src="js/jquery.min.js"></script><script type="text/javascript" src="js/page_effects.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body><div id="header"><h2>Generated by <a href="https://github.com/weavejester/codox">Codox</a></h2><h1><a href="index.html"><span class="project-title"><span class="project-name">ShiftLefter</span> <span class="project-version">0.3.6-SNAPSHOT</span></span></a></h1></div><div class="sidebar primary"><h3 class="no-link"><span class="inner">Project</span></h3><ul class="index-link"><li class="depth-1 "><a href="index.html"><div class="inner">Index</div></a></li></ul><h3 class="no-link"><span class="inner">Namespaces</span></h3><ul><li class="depth-1"><div class="no-link"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>shiftlefter</span></div></div></li><li class="depth-2"><div class="no-link"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>adapters</span></div></div></li><li class="depth-3 branch"><a href="shiftlefter.adapters.etaoin.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>etaoin</span></div></a></li><li class="depth-3"><a href="shiftlefter.adapters.registry.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>registry</span></div></a></li><li class="depth-2"><div class="no-link"><div class="inner"><span class="tree" style="top: -83px;"><span class="top" style="height: 92px;"></span><span class="bottom"></span></span><span>browser</span></div></div></li><li class="depth-3 branch"><a href="shiftlefter.browser.chrome.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>chrome</span></div></a></li><li class="depth-3 branch"><a href="shiftlefter.browser.ctx.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>ctx</span></div></a></li><li class="depth-3 branch"><a href="shiftlefter.browser.locators.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>locators</span></div></a></li><li class="depth-3"><a href="shiftlefter.browser.protocol.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>protocol</span></div></a></li><li class="depth-2"><div class="no-link"><div class="inner"><span class="tree" style="top: -145px;"><span class="top" style="height: 154px;"></span><span class="bottom"></span></span><span>capabilities</span></div></div></li><li class="depth-3"><a href="shiftlefter.capabilities.ctx.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>ctx</span></div></a></li><li class="depth-2"><div class="no-link"><div class="inner"><span class="tree" style="top: -52px;"><span class="top" style="height: 61px;"></span><span class="bottom"></span></span><span>config</span></div></div></li><li class="depth-3"><a href="shiftlefter.config.user.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>user</span></div></a></li><li class="depth-2 branch"><a href="shiftlefter.core.html"><div class="inner"><span class="tree" style="top: -52px;"><span class="top" style="height: 61px;"></span><span class="bottom"></span></span><span>core</span></div></a></li><li class="depth-2"><div class="no-link"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>gherkin</span></div></div></li><li class="depth-3 branch"><a href="shiftlefter.gherkin.api.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>api</span></div></a></li><li class="depth-3 branch"><a href="shiftlefter.gherkin.compliance.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>compliance</span></div></a></li><li class="depth-3 branch"><a href="shiftlefter.gherkin.ddmin.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>ddmin</span></div></a></li><li class="depth-3 branch"><a href="shiftlefter.gherkin.diagnostics.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>diagnostics</span></div></a></li><li class="depth-3 branch"><a href="shiftlefter.gherkin.dialect.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>dialect</span></div></a></li><li class="depth-3 branch"><a href="shiftlefter.gherkin.fuzz.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>fuzz</span></div></a></li><li class="depth-3 branch"><a href="shiftlefter.gherkin.io.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>io</span></div></a></li><li class="depth-3 branch"><a href="shiftlefter.gherkin.lexer.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>lexer</span></div></a></li><li class="depth-3 branch"><a href="shiftlefter.gherkin.location.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>location</span></div></a></li><li class="depth-3 branch"><a href="shiftlefter.gherkin.parser.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>parser</span></div></a></li><li class="depth-3 branch"><a href="shiftlefter.gherkin.pickler.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>pickler</span></div></a></li><li class="depth-3 branch"><a href="shiftlefter.gherkin.printer.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>printer</span></div></a></li><li class="depth-3 branch"><a href="shiftlefter.gherkin.tokens.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>tokens</span></div></a></li><li class="depth-3"><a href="shiftlefter.gherkin.verify.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>verify</span></div></a></li><li class="depth-2 branch"><a href="shiftlefter.repl.html"><div class="inner"><span class="tree" style="top: -455px;"><span class="top" style="height: 464px;"></span><span class="bottom"></span></span><span>repl</span></div></a></li><li class="depth-2"><div class="no-link"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>runner</span></div></div></li><li class="depth-3 branch"><a href="shiftlefter.runner.config.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>config</span></div></a></li><li class="depth-3 branch"><a href="shiftlefter.runner.core.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>core</span></div></a></li><li class="depth-3 branch"><a href="shiftlefter.runner.discover.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>discover</span></div></a></li><li class="depth-3 branch"><a href="shiftlefter.runner.events.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>events</span></div></a></li><li class="depth-3"><div class="no-link"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>report</span></div></div></li><li class="depth-4 branch"><a href="shiftlefter.runner.report.console.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>console</span></div></a></li><li class="depth-4"><a href="shiftlefter.runner.report.edn.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>edn</span></div></a></li><li class="depth-3"><a href="shiftlefter.runner.step-loader.html"><div class="inner"><span class="tree" style="top: -83px;"><span class="top" style="height: 92px;"></span><span class="bottom"></span></span><span>step-loader</span></div></a></li><li class="depth-2 branch"><a href="shiftlefter.step.html"><div class="inner"><span class="tree" style="top: -269px;"><span class="top" style="height: 278px;"></span><span class="bottom"></span></span><span>step</span></div></a></li><li class="depth-2"><div class="no-link"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>stepdefs</span></div></div></li><li class="depth-3"><a href="shiftlefter.stepdefs.browser.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>browser</span></div></a></li><li class="depth-2"><div class="no-link"><div class="inner"><span class="tree" style="top: -52px;"><span class="top" style="height: 61px;"></span><span class="bottom"></span></span><span>stepengine</span></div></div></li><li class="depth-3 branch"><a href="shiftlefter.stepengine.bind.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>bind</span></div></a></li><li class="depth-3 branch"><a href="shiftlefter.stepengine.compile.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>compile</span></div></a></li><li class="depth-3 branch current"><a href="shiftlefter.stepengine.exec.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>exec</span></div></a></li><li class="depth-3"><a href="shiftlefter.stepengine.macros.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>macros</span></div></a></li><li class="depth-4"><a href="shiftlefter.stepengine.macros.ini.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>ini</span></div></a></li><li class="depth-3"><a href="shiftlefter.stepengine.registry.html"><div class="inner"><span class="tree" style="top: -52px;"><span class="top" style="height: 61px;"></span><span class="bottom"></span></span><span>registry</span></div></a></li><li class="depth-2"><a href="shiftlefter.subjects.html"><div class="inner"><span class="tree" style="top: -207px;"><span class="top" style="height: 216px;"></span><span class="bottom"></span></span><span>subjects</span></div></a></li><li class="depth-3 branch"><a href="shiftlefter.subjects.browser.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>browser</span></div></a></li><li class="depth-3"><a href="shiftlefter.subjects.profile.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>profile</span></div></a></li><li class="depth-2"><div class="no-link"><div class="inner"><span class="tree" style="top: -83px;"><span class="top" style="height: 92px;"></span><span class="bottom"></span></span><span>svo</span></div></div></li><li class="depth-3 branch"><a href="shiftlefter.svo.extract.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>extract</span></div></a></li><li class="depth-3 branch"><a href="shiftlefter.svo.glossary.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>glossary</span></div></a></li><li class="depth-3"><a href="shiftlefter.svo.validate.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>validate</span></div></a></li><li class="depth-2"><div class="no-link"><div class="inner"><span class="tree" style="top: -114px;"><span class="top" style="height: 123px;"></span><span class="bottom"></span></span><span>webdriver</span></div></div></li><li class="depth-3"><div class="no-link"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>etaoin</span></div></div></li><li class="depth-4 branch"><a href="shiftlefter.webdriver.etaoin.browser.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>browser</span></div></a></li><li class="depth-4"><a href="shiftlefter.webdriver.etaoin.session.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>session</span></div></a></li><li class="depth-3"><a href="shiftlefter.webdriver.session-store.html"><div class="inner"><span class="tree" style="top: -83px;"><span class="top" style="height: 92px;"></span><span class="bottom"></span></span><span>session-store</span></div></a></li></ul></div><div class="sidebar secondary"><h3><a href="#top"><span class="inner">Public Vars</span></a></h3><ul><li class="depth-1"><a href="shiftlefter.stepengine.exec.html#var-execute-scenario"><div class="inner"><span>execute-scenario</span></div></a></li><li class="depth-1"><a href="shiftlefter.stepengine.exec.html#var-execute-suite"><div class="inner"><span>execute-suite</span></div></a></li><li class="depth-1"><a href="shiftlefter.stepengine.exec.html#var-invoke-step"><div class="inner"><span>invoke-step</span></div></a></li></ul></div><div class="namespace-docs" id="content"><h1 class="anchor" id="top">shiftlefter.stepengine.exec</h1><div class="doc"><div class="markdown"><p>Step execution engine for ShiftLefter runner.</p>
<p>Executes bound steps with context threading and fail-fast semantics.</p>
<h2><a href="#invocation-dispatch" id="invocation-dispatch"></a>Invocation Dispatch</h2>
<p>Based on step arity (A) vs capture count (C): - <code>A == C</code> → call with captures only (no ctx) - <code>A == C+1</code> → call with ctx as FIRST arg, then captures</p>
<h2><a href="#context-shape-passed-to-steps" id="context-shape-passed-to-steps"></a>Context Shape (passed to steps)</h2>
<p>Step functions receive flat scenario state as ctx:</p>
<pre><code class="language-clojure">{:cucumbers 12, :user "alice", ...}  ;; just your scenario data
</code></pre>
<p>Step metadata is available via <code>(meta ctx)</code>: - <code>:step/arguments</code> — DataTable or DocString - <code>:step/text</code> — step text after substitution - <code>:step/keyword</code> — Given/When/Then/And/But</p>
<p>Use helpers: <code>(require '[shiftlefter.step :as step])</code> - <code>(step/arguments ctx)</code> — get DataTable/DocString - <code>(step/text ctx)</code> — get step text</p>
<h2><a href="#return-handling" id="return-handling"></a>Return Handling</h2>
<table>
<thead>
<tr><th> Step returns </th><th> Result </th></tr>
</thead>
<tbody>
<tr><td> map         </td><td> New scenario-ctx (replaces previous) </td></tr>
<tr><td> nil         </td><td> ctx unchanged, step passed </td></tr>
<tr><td> :pending    </td><td> Step pending, scenario fails, remaining skipped </td></tr>
<tr><td> other       </td><td> Step failed (invalid return), scenario fails </td></tr>
<tr><td> throws      </td><td> Step failed, scenario fails, remaining skipped </td></tr>
</tbody>
</table>
<h2><a href="#execution-semantics" id="execution-semantics"></a>Execution Semantics</h2>
<ul>
<li>Scenario: fail-fast — on failure/pending, skip remaining steps</li>
<li>Suite: continue — after scenario fails, proceed to next scenario</li>
</ul>
<h2><a href="#browser-lifecycle-cli" id="browser-lifecycle-cli"></a>Browser Lifecycle (CLI)</h2>
<ul>
<li>CLI runs are safe-by-default: sessions always close after scenario</li>
<li>No surface persistence in CLI mode (0.2.5)</li>
<li>Cleanup runs even on scenario failure</li>
</ul>
</div></div><div class="public anchor" id="var-execute-scenario"><h3>execute-scenario</h3><div class="usage"><code>(execute-scenario plan initial-ctx)</code><code>(execute-scenario plan initial-ctx opts)</code></div><div class="doc"><div class="markdown"><p>Execute all steps for a single scenario/pickle plan.</p>
<p>Parameters: - plan: run plan from binder {:plan/id … :plan/steps <a href="...">…</a> …} - initial-ctx: starting scenario context (usually {}) - opts: optional execution options {:interfaces {…}}</p>
<p>Returns: - {:status :passed|:failed|:pending|:skipped :plan plan :steps <a href="{:step ... :status ... :error ...} ...">{:step … :status … :error …} …</a> :scenario-ctx <final-ctx>}</final-ctx></p>
<p>Semantics: - Steps execute in order, threading scenario-ctx - On failure/pending, remaining steps are skipped - Synthetic steps (macro wrappers) pass without execution - Wrapper status rolls up from children (any fail → fail, any pending → pending) - Auto-provisioning: if step has :svoi with :interface, capability is provisioned</p>
</div></div><div class="src-link"><a href="https://github.com/SHIFT-LEFTER/shiftlefter/blob/v0.3.6-SNAPSHOT/src/shiftlefter/stepengine/exec.clj#L335">view source</a></div></div><div class="public anchor" id="var-execute-suite"><h3>execute-suite</h3><div class="usage"><code>(execute-suite plans)</code><code>(execute-suite plans opts)</code></div><div class="doc"><div class="markdown"><p>Execute all scenarios in a suite.</p>
<p>Parameters: - plans: seq of run plans from binder - opts: options map {:interfaces {…}}</p>
<p>Returns: - {:scenarios <a href="{:status ... :plan ... :steps ... :capability-cleanup ... :browser-cleanup ...} ...">{:status … :plan … :steps … :capability-cleanup … :browser-cleanup …} …</a> :counts {:passed N :failed N :pending N :skipped N} :status :passed|:failed}</p>
<p>Semantics: - Each scenario starts with fresh ctx ({}) - Suite continues after scenario failure - Suite :passed only if all scenarios :passed - Auto-provisioning: capabilities created on demand per :interfaces config - Ephemeral capabilities cleaned up after each scenario - Persistent capabilities survive across scenarios</p>
</div></div><div class="src-link"><a href="https://github.com/SHIFT-LEFTER/shiftlefter/blob/v0.3.6-SNAPSHOT/src/shiftlefter/stepengine/exec.clj#L546">view source</a></div></div><div class="public anchor" id="var-invoke-step"><h3>invoke-step</h3><div class="usage"><code>(invoke-step binding captures ctx)</code></div><div class="doc"><div class="markdown"><p>Invoke a single step function with appropriate dispatch.</p>
<p>Parameters: - binding: step binding from binder {:fn f :arity A :captures <a href="...">…</a> …} - captures: vector of captured groups from regex match - ctx: execution context {:step step-map :scenario scenario-ctx}</p>
<h2><a href="#dispatch-rules" id="dispatch-rules"></a>Dispatch Rules</h2>
<p>Based on step function arity (A) vs capture count (C): - <code>A == C</code> → call with captures only (no ctx) - <code>A == C+1</code> → call with ctx as FIRST arg, then captures</p>
<h2><a href="#context-shape" id="context-shape"></a>Context Shape</h2>
<p>The ctx passed to step functions is: - Flat scenario state (accumulated from previous steps) - Step metadata available via <code>(meta ctx)</code> with <code>:step/*</code> keys</p>
<p>Returns: - {:status :passed :scenario <new-ctx>} - {:status :pending :scenario <ctx>} - {:status :failed :scenario <ctx> :error {:type … :message …}}</ctx></ctx></new-ctx></p>
</div></div><div class="src-link"><a href="https://github.com/SHIFT-LEFTER/shiftlefter/blob/v0.3.6-SNAPSHOT/src/shiftlefter/stepengine/exec.clj#L58">view source</a></div></div></div></body></html>