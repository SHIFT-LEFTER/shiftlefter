<!DOCTYPE html PUBLIC ""
    "">
<html><head><meta charset="UTF-8" /><title>shiftlefter.stepengine.bind documentation</title><link rel="stylesheet" type="text/css" href="css/default.css" /><link rel="stylesheet" type="text/css" href="css/highlight.css" /><script type="text/javascript" src="js/highlight.min.js"></script><script type="text/javascript" src="js/jquery.min.js"></script><script type="text/javascript" src="js/page_effects.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body><div id="header"><h2>Generated by <a href="https://github.com/weavejester/codox">Codox</a></h2><h1><a href="index.html"><span class="project-title"><span class="project-name">ShiftLefter</span> <span class="project-version">0.3.6-SNAPSHOT</span></span></a></h1></div><div class="sidebar primary"><h3 class="no-link"><span class="inner">Project</span></h3><ul class="index-link"><li class="depth-1 "><a href="index.html"><div class="inner">Index</div></a></li></ul><h3 class="no-link"><span class="inner">Namespaces</span></h3><ul><li class="depth-1"><div class="no-link"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>shiftlefter</span></div></div></li><li class="depth-2"><div class="no-link"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>adapters</span></div></div></li><li class="depth-3 branch"><a href="shiftlefter.adapters.etaoin.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>etaoin</span></div></a></li><li class="depth-3"><a href="shiftlefter.adapters.registry.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>registry</span></div></a></li><li class="depth-2"><div class="no-link"><div class="inner"><span class="tree" style="top: -83px;"><span class="top" style="height: 92px;"></span><span class="bottom"></span></span><span>browser</span></div></div></li><li class="depth-3 branch"><a href="shiftlefter.browser.chrome.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>chrome</span></div></a></li><li class="depth-3 branch"><a href="shiftlefter.browser.ctx.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>ctx</span></div></a></li><li class="depth-3 branch"><a href="shiftlefter.browser.locators.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>locators</span></div></a></li><li class="depth-3"><a href="shiftlefter.browser.protocol.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>protocol</span></div></a></li><li class="depth-2"><div class="no-link"><div class="inner"><span class="tree" style="top: -145px;"><span class="top" style="height: 154px;"></span><span class="bottom"></span></span><span>capabilities</span></div></div></li><li class="depth-3"><a href="shiftlefter.capabilities.ctx.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>ctx</span></div></a></li><li class="depth-2"><div class="no-link"><div class="inner"><span class="tree" style="top: -52px;"><span class="top" style="height: 61px;"></span><span class="bottom"></span></span><span>config</span></div></div></li><li class="depth-3"><a href="shiftlefter.config.user.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>user</span></div></a></li><li class="depth-2 branch"><a href="shiftlefter.core.html"><div class="inner"><span class="tree" style="top: -52px;"><span class="top" style="height: 61px;"></span><span class="bottom"></span></span><span>core</span></div></a></li><li class="depth-2"><div class="no-link"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>gherkin</span></div></div></li><li class="depth-3 branch"><a href="shiftlefter.gherkin.api.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>api</span></div></a></li><li class="depth-3 branch"><a href="shiftlefter.gherkin.compliance.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>compliance</span></div></a></li><li class="depth-3 branch"><a href="shiftlefter.gherkin.ddmin.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>ddmin</span></div></a></li><li class="depth-3 branch"><a href="shiftlefter.gherkin.diagnostics.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>diagnostics</span></div></a></li><li class="depth-3 branch"><a href="shiftlefter.gherkin.dialect.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>dialect</span></div></a></li><li class="depth-3 branch"><a href="shiftlefter.gherkin.fuzz.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>fuzz</span></div></a></li><li class="depth-3 branch"><a href="shiftlefter.gherkin.io.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>io</span></div></a></li><li class="depth-3 branch"><a href="shiftlefter.gherkin.lexer.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>lexer</span></div></a></li><li class="depth-3 branch"><a href="shiftlefter.gherkin.location.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>location</span></div></a></li><li class="depth-3 branch"><a href="shiftlefter.gherkin.parser.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>parser</span></div></a></li><li class="depth-3 branch"><a href="shiftlefter.gherkin.pickler.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>pickler</span></div></a></li><li class="depth-3 branch"><a href="shiftlefter.gherkin.printer.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>printer</span></div></a></li><li class="depth-3 branch"><a href="shiftlefter.gherkin.tokens.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>tokens</span></div></a></li><li class="depth-3"><a href="shiftlefter.gherkin.verify.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>verify</span></div></a></li><li class="depth-2 branch"><a href="shiftlefter.repl.html"><div class="inner"><span class="tree" style="top: -455px;"><span class="top" style="height: 464px;"></span><span class="bottom"></span></span><span>repl</span></div></a></li><li class="depth-2"><div class="no-link"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>runner</span></div></div></li><li class="depth-3 branch"><a href="shiftlefter.runner.config.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>config</span></div></a></li><li class="depth-3 branch"><a href="shiftlefter.runner.core.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>core</span></div></a></li><li class="depth-3 branch"><a href="shiftlefter.runner.discover.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>discover</span></div></a></li><li class="depth-3 branch"><a href="shiftlefter.runner.events.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>events</span></div></a></li><li class="depth-3"><div class="no-link"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>report</span></div></div></li><li class="depth-4 branch"><a href="shiftlefter.runner.report.console.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>console</span></div></a></li><li class="depth-4"><a href="shiftlefter.runner.report.edn.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>edn</span></div></a></li><li class="depth-3"><a href="shiftlefter.runner.step-loader.html"><div class="inner"><span class="tree" style="top: -83px;"><span class="top" style="height: 92px;"></span><span class="bottom"></span></span><span>step-loader</span></div></a></li><li class="depth-2 branch"><a href="shiftlefter.step.html"><div class="inner"><span class="tree" style="top: -269px;"><span class="top" style="height: 278px;"></span><span class="bottom"></span></span><span>step</span></div></a></li><li class="depth-2"><div class="no-link"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>stepdefs</span></div></div></li><li class="depth-3"><a href="shiftlefter.stepdefs.browser.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>browser</span></div></a></li><li class="depth-2"><div class="no-link"><div class="inner"><span class="tree" style="top: -52px;"><span class="top" style="height: 61px;"></span><span class="bottom"></span></span><span>stepengine</span></div></div></li><li class="depth-3 branch current"><a href="shiftlefter.stepengine.bind.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>bind</span></div></a></li><li class="depth-3 branch"><a href="shiftlefter.stepengine.compile.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>compile</span></div></a></li><li class="depth-3 branch"><a href="shiftlefter.stepengine.exec.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>exec</span></div></a></li><li class="depth-3"><a href="shiftlefter.stepengine.macros.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>macros</span></div></a></li><li class="depth-4"><a href="shiftlefter.stepengine.macros.ini.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>ini</span></div></a></li><li class="depth-3"><a href="shiftlefter.stepengine.registry.html"><div class="inner"><span class="tree" style="top: -52px;"><span class="top" style="height: 61px;"></span><span class="bottom"></span></span><span>registry</span></div></a></li><li class="depth-2"><a href="shiftlefter.subjects.html"><div class="inner"><span class="tree" style="top: -207px;"><span class="top" style="height: 216px;"></span><span class="bottom"></span></span><span>subjects</span></div></a></li><li class="depth-3 branch"><a href="shiftlefter.subjects.browser.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>browser</span></div></a></li><li class="depth-3"><a href="shiftlefter.subjects.profile.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>profile</span></div></a></li><li class="depth-2"><div class="no-link"><div class="inner"><span class="tree" style="top: -83px;"><span class="top" style="height: 92px;"></span><span class="bottom"></span></span><span>svo</span></div></div></li><li class="depth-3 branch"><a href="shiftlefter.svo.extract.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>extract</span></div></a></li><li class="depth-3 branch"><a href="shiftlefter.svo.glossary.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>glossary</span></div></a></li><li class="depth-3"><a href="shiftlefter.svo.validate.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>validate</span></div></a></li><li class="depth-2"><div class="no-link"><div class="inner"><span class="tree" style="top: -114px;"><span class="top" style="height: 123px;"></span><span class="bottom"></span></span><span>webdriver</span></div></div></li><li class="depth-3"><div class="no-link"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>etaoin</span></div></div></li><li class="depth-4 branch"><a href="shiftlefter.webdriver.etaoin.browser.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>browser</span></div></a></li><li class="depth-4"><a href="shiftlefter.webdriver.etaoin.session.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>session</span></div></a></li><li class="depth-3"><a href="shiftlefter.webdriver.session-store.html"><div class="inner"><span class="tree" style="top: -83px;"><span class="top" style="height: 92px;"></span><span class="bottom"></span></span><span>session-store</span></div></a></li></ul></div><div class="sidebar secondary"><h3><a href="#top"><span class="inner">Public Vars</span></a></h3><ul><li class="depth-1"><a href="shiftlefter.stepengine.bind.html#var-bind-pickle"><div class="inner"><span>bind-pickle</span></div></a></li><li class="depth-1"><a href="shiftlefter.stepengine.bind.html#var-bind-step"><div class="inner"><span>bind-step</span></div></a></li><li class="depth-1"><a href="shiftlefter.stepengine.bind.html#var-bind-suite"><div class="inner"><span>bind-suite</span></div></a></li><li class="depth-1"><a href="shiftlefter.stepengine.bind.html#var-match-step"><div class="inner"><span>match-step</span></div></a></li><li class="depth-1"><a href="shiftlefter.stepengine.bind.html#var-validate-arity"><div class="inner"><span>validate-arity</span></div></a></li></ul></div><div class="namespace-docs" id="content"><h1 class="anchor" id="top">shiftlefter.stepengine.bind</h1><div class="doc"><div class="markdown"><p>Step binding / planning pass for ShiftLefter runner.</p>
<p>Binds pickle steps to step definitions before execution, producing run plans with full binding information. This enables: - Early detection of undefined/ambiguous steps (exit 2, no execution) - Complete plan visibility before any side effects - Clear diagnostics for all binding issues</p>
<h2><a href="#binding-rules" id="binding-rules"></a>Binding Rules</h2>
<ul>
<li>Full-string match only (<code>re-matches</code>, not <code>re-find</code>)</li>
<li>0 matches → <code>:status :undefined</code></li>
<li>1 match → <code>:status :matched</code></li>
<li>2+ matches → <code>:status :ambiguous</code></li>
</ul>
<h2><a href="#arity-validation" id="arity-validation"></a>Arity Validation</h2>
<p>For matched steps, validates that step function arity is compatible: - <code>C</code> = capture count (from regex groups) - <code>A</code> = declared arity (from stepdef) - Valid if <code>A == C</code> (captures only) or <code>A == C+1</code> (captures + ctx)</p>
<h2><a href="#svo-extraction" id="svo-extraction"></a>SVO Extraction</h2>
<p>For matched steps with <code>:metadata</code> containing <code>:svo</code>, extracts SVOI: - <code>:svoi</code> key added to binding with extracted subject/verb/object/interface - Legacy steps (no metadata) get <code>:svoi nil</code></p>
<h2><a href="#svo-validation" id="svo-validation"></a>SVO Validation</h2>
<p>When validation options are provided to <code>bind-suite</code>, extracted SVOIs are validated against glossaries and interface config: - <code>:unknown-subject :warn</code> — log warning, don’t block - <code>:unknown-subject :error</code> — log error, block execution - Same for <code>:unknown-verb</code> and <code>:unknown-interface</code></p>
<h2><a href="#usage" id="usage"></a>Usage</h2>
<pre><code class="language-clojure">(let [stepdefs (registry/all-stepdefs)
      {:keys [plans diagnostics]} (bind-suite pickles stepdefs)]
  (if (seq (:issues diagnostics))
    (report-and-exit-2 diagnostics)
    (execute-plans plans)))
</code></pre>
</div></div><div class="public anchor" id="var-bind-pickle"><h3>bind-pickle</h3><div class="usage"><code>(bind-pickle pickle stepdefs)</code></div><div class="doc"><div class="markdown"><p>Generate a run plan for a pickle by binding all its steps.</p>
<p>Returns run plan: - :plan/id - UUID for this plan - :plan/pickle - the original pickle - :plan/steps - seq of bound steps - :plan/runnable? - true iff all steps matched with valid arity (or synthetic)</p>
</div></div><div class="src-link"><a href="https://github.com/SHIFT-LEFTER/shiftlefter/blob/v0.3.6-SNAPSHOT/src/shiftlefter/stepengine/bind.clj#L157">view source</a></div></div><div class="public anchor" id="var-bind-step"><h3>bind-step</h3><div class="usage"><code>(bind-step pickle-step stepdefs)</code></div><div class="doc"><div class="markdown"><p>Bind a pickle step to stepdefs.</p>
<p>Returns: - :status - :matched | :undefined | :ambiguous | :synthetic - :step - the original pickle step - :binding - for matched: stepdef info + captures + arity validation - :alternatives - for ambiguous: all matching stepdefs (summaries)</p>
<p>Synthetic steps (macro wrappers with :step/synthetic? true) are auto-bound with :status :synthetic and no binding - they exist for events/reporting only.</p>
</div></div><div class="src-link"><a href="https://github.com/SHIFT-LEFTER/shiftlefter/blob/v0.3.6-SNAPSHOT/src/shiftlefter/stepengine/bind.clj#L103">view source</a></div></div><div class="public anchor" id="var-bind-suite"><h3>bind-suite</h3><div class="usage"><code>(bind-suite pickles stepdefs)</code><code>(bind-suite pickles stepdefs opts)</code></div><div class="doc"><div class="markdown"><p>Bind all pickles to stepdefs, producing plans and diagnostics.</p>
<p>Parameters: - pickles: Seq of pickles to bind - stepdefs: Seq of step definitions - opts: Optional map with SVO validation settings: - :glossary — loaded glossary for SVO validation - :interfaces — interface config map - :svo — enforcement config {:unknown-subject :warn|:error …}</p>
<p>Returns: - :plans - seq of run plans (one per pickle) - :runnable? - true iff all plans are runnable and no blocking SVO issues - :diagnostics - summary of binding issues</p>
<p>Diagnostics structure: - :undefined - steps with no matching stepdef - :ambiguous - steps matching 2+ stepdefs - :invalid-arity - matched steps with arity mismatch - :svo-issues - SVO validation issues (when opts provided) - :counts - {:undefined-count N :ambiguous-count N :svo-issue-count N …}</p>
</div></div><div class="src-link"><a href="https://github.com/SHIFT-LEFTER/shiftlefter/blob/v0.3.6-SNAPSHOT/src/shiftlefter/stepengine/bind.clj#L274">view source</a></div></div><div class="public anchor" id="var-match-step"><h3>match-step</h3><div class="usage"><code>(match-step step-text stepdef)</code></div><div class="doc"><div class="markdown"><p>Match step text against a stepdef using full-string match.</p>
<p>Returns nil if no match, or map with: - :stepdef - the matching stepdef - :captures - vector of captured groups (may include nils for optional groups)</p>
</div></div><div class="src-link"><a href="https://github.com/SHIFT-LEFTER/shiftlefter/blob/v0.3.6-SNAPSHOT/src/shiftlefter/stepengine/bind.clj#L54">view source</a></div></div><div class="public anchor" id="var-validate-arity"><h3>validate-arity</h3><div class="usage"><code>(validate-arity capture-count declared-arity)</code></div><div class="doc"><div class="markdown"><p>Validate that stepdef arity is compatible with capture count.</p>
<ul>
<li>C = capture count</li>
<li>A = declared arity</li>
<li>Valid if A == C (captures only) or A == C+1 (captures + ctx)</li>
</ul>
<p>Returns: - :arity-ok? - boolean - :expected - set of valid arities #{C (C+1)} - :actual - declared arity A</p>
</div></div><div class="src-link"><a href="https://github.com/SHIFT-LEFTER/shiftlefter/blob/v0.3.6-SNAPSHOT/src/shiftlefter/stepengine/bind.clj#L77">view source</a></div></div></div></body></html>