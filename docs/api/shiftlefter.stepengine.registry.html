<!DOCTYPE html PUBLIC ""
    "">
<html><head><meta charset="UTF-8" /><title>shiftlefter.stepengine.registry documentation</title><link rel="stylesheet" type="text/css" href="css/default.css" /><link rel="stylesheet" type="text/css" href="css/highlight.css" /><script type="text/javascript" src="js/highlight.min.js"></script><script type="text/javascript" src="js/jquery.min.js"></script><script type="text/javascript" src="js/page_effects.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body><div id="header"><h2>Generated by <a href="https://github.com/weavejester/codox">Codox</a></h2><h1><a href="index.html"><span class="project-title"><span class="project-name">ShiftLefter</span> <span class="project-version">0.3.6-SNAPSHOT</span></span></a></h1></div><div class="sidebar primary"><h3 class="no-link"><span class="inner">Project</span></h3><ul class="index-link"><li class="depth-1 "><a href="index.html"><div class="inner">Index</div></a></li></ul><h3 class="no-link"><span class="inner">Namespaces</span></h3><ul><li class="depth-1"><div class="no-link"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>shiftlefter</span></div></div></li><li class="depth-2"><div class="no-link"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>adapters</span></div></div></li><li class="depth-3 branch"><a href="shiftlefter.adapters.etaoin.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>etaoin</span></div></a></li><li class="depth-3"><a href="shiftlefter.adapters.registry.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>registry</span></div></a></li><li class="depth-2"><div class="no-link"><div class="inner"><span class="tree" style="top: -83px;"><span class="top" style="height: 92px;"></span><span class="bottom"></span></span><span>browser</span></div></div></li><li class="depth-3 branch"><a href="shiftlefter.browser.chrome.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>chrome</span></div></a></li><li class="depth-3 branch"><a href="shiftlefter.browser.ctx.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>ctx</span></div></a></li><li class="depth-3 branch"><a href="shiftlefter.browser.locators.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>locators</span></div></a></li><li class="depth-3"><a href="shiftlefter.browser.protocol.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>protocol</span></div></a></li><li class="depth-2"><div class="no-link"><div class="inner"><span class="tree" style="top: -145px;"><span class="top" style="height: 154px;"></span><span class="bottom"></span></span><span>capabilities</span></div></div></li><li class="depth-3"><a href="shiftlefter.capabilities.ctx.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>ctx</span></div></a></li><li class="depth-2"><div class="no-link"><div class="inner"><span class="tree" style="top: -52px;"><span class="top" style="height: 61px;"></span><span class="bottom"></span></span><span>config</span></div></div></li><li class="depth-3"><a href="shiftlefter.config.user.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>user</span></div></a></li><li class="depth-2 branch"><a href="shiftlefter.core.html"><div class="inner"><span class="tree" style="top: -52px;"><span class="top" style="height: 61px;"></span><span class="bottom"></span></span><span>core</span></div></a></li><li class="depth-2"><div class="no-link"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>gherkin</span></div></div></li><li class="depth-3 branch"><a href="shiftlefter.gherkin.api.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>api</span></div></a></li><li class="depth-3 branch"><a href="shiftlefter.gherkin.compliance.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>compliance</span></div></a></li><li class="depth-3 branch"><a href="shiftlefter.gherkin.ddmin.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>ddmin</span></div></a></li><li class="depth-3 branch"><a href="shiftlefter.gherkin.diagnostics.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>diagnostics</span></div></a></li><li class="depth-3 branch"><a href="shiftlefter.gherkin.dialect.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>dialect</span></div></a></li><li class="depth-3 branch"><a href="shiftlefter.gherkin.fuzz.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>fuzz</span></div></a></li><li class="depth-3 branch"><a href="shiftlefter.gherkin.io.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>io</span></div></a></li><li class="depth-3 branch"><a href="shiftlefter.gherkin.lexer.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>lexer</span></div></a></li><li class="depth-3 branch"><a href="shiftlefter.gherkin.location.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>location</span></div></a></li><li class="depth-3 branch"><a href="shiftlefter.gherkin.parser.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>parser</span></div></a></li><li class="depth-3 branch"><a href="shiftlefter.gherkin.pickler.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>pickler</span></div></a></li><li class="depth-3 branch"><a href="shiftlefter.gherkin.printer.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>printer</span></div></a></li><li class="depth-3 branch"><a href="shiftlefter.gherkin.tokens.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>tokens</span></div></a></li><li class="depth-3"><a href="shiftlefter.gherkin.verify.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>verify</span></div></a></li><li class="depth-2 branch"><a href="shiftlefter.repl.html"><div class="inner"><span class="tree" style="top: -455px;"><span class="top" style="height: 464px;"></span><span class="bottom"></span></span><span>repl</span></div></a></li><li class="depth-2"><div class="no-link"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>runner</span></div></div></li><li class="depth-3 branch"><a href="shiftlefter.runner.config.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>config</span></div></a></li><li class="depth-3 branch"><a href="shiftlefter.runner.core.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>core</span></div></a></li><li class="depth-3 branch"><a href="shiftlefter.runner.discover.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>discover</span></div></a></li><li class="depth-3 branch"><a href="shiftlefter.runner.events.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>events</span></div></a></li><li class="depth-3"><div class="no-link"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>report</span></div></div></li><li class="depth-4 branch"><a href="shiftlefter.runner.report.console.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>console</span></div></a></li><li class="depth-4"><a href="shiftlefter.runner.report.edn.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>edn</span></div></a></li><li class="depth-3"><a href="shiftlefter.runner.step-loader.html"><div class="inner"><span class="tree" style="top: -83px;"><span class="top" style="height: 92px;"></span><span class="bottom"></span></span><span>step-loader</span></div></a></li><li class="depth-2 branch"><a href="shiftlefter.step.html"><div class="inner"><span class="tree" style="top: -269px;"><span class="top" style="height: 278px;"></span><span class="bottom"></span></span><span>step</span></div></a></li><li class="depth-2"><div class="no-link"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>stepdefs</span></div></div></li><li class="depth-3"><a href="shiftlefter.stepdefs.browser.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>browser</span></div></a></li><li class="depth-2"><div class="no-link"><div class="inner"><span class="tree" style="top: -52px;"><span class="top" style="height: 61px;"></span><span class="bottom"></span></span><span>stepengine</span></div></div></li><li class="depth-3 branch"><a href="shiftlefter.stepengine.bind.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>bind</span></div></a></li><li class="depth-3 branch"><a href="shiftlefter.stepengine.compile.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>compile</span></div></a></li><li class="depth-3 branch"><a href="shiftlefter.stepengine.exec.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>exec</span></div></a></li><li class="depth-3"><a href="shiftlefter.stepengine.macros.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>macros</span></div></a></li><li class="depth-4"><a href="shiftlefter.stepengine.macros.ini.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>ini</span></div></a></li><li class="depth-3 current"><a href="shiftlefter.stepengine.registry.html"><div class="inner"><span class="tree" style="top: -52px;"><span class="top" style="height: 61px;"></span><span class="bottom"></span></span><span>registry</span></div></a></li><li class="depth-2"><a href="shiftlefter.subjects.html"><div class="inner"><span class="tree" style="top: -207px;"><span class="top" style="height: 216px;"></span><span class="bottom"></span></span><span>subjects</span></div></a></li><li class="depth-3 branch"><a href="shiftlefter.subjects.browser.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>browser</span></div></a></li><li class="depth-3"><a href="shiftlefter.subjects.profile.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>profile</span></div></a></li><li class="depth-2"><div class="no-link"><div class="inner"><span class="tree" style="top: -83px;"><span class="top" style="height: 92px;"></span><span class="bottom"></span></span><span>svo</span></div></div></li><li class="depth-3 branch"><a href="shiftlefter.svo.extract.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>extract</span></div></a></li><li class="depth-3 branch"><a href="shiftlefter.svo.glossary.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>glossary</span></div></a></li><li class="depth-3"><a href="shiftlefter.svo.validate.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>validate</span></div></a></li><li class="depth-2"><div class="no-link"><div class="inner"><span class="tree" style="top: -114px;"><span class="top" style="height: 123px;"></span><span class="bottom"></span></span><span>webdriver</span></div></div></li><li class="depth-3"><div class="no-link"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>etaoin</span></div></div></li><li class="depth-4 branch"><a href="shiftlefter.webdriver.etaoin.browser.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>browser</span></div></a></li><li class="depth-4"><a href="shiftlefter.webdriver.etaoin.session.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>session</span></div></a></li><li class="depth-3"><a href="shiftlefter.webdriver.session-store.html"><div class="inner"><span class="tree" style="top: -83px;"><span class="top" style="height: 92px;"></span><span class="bottom"></span></span><span>session-store</span></div></a></li></ul></div><div class="sidebar secondary"><h3><a href="#top"><span class="inner">Public Vars</span></a></h3><ul><li class="depth-1"><a href="shiftlefter.stepengine.registry.html#var-all-stepdefs"><div class="inner"><span>all-stepdefs</span></div></a></li><li class="depth-1"><a href="shiftlefter.stepengine.registry.html#var-clear-registry.21"><div class="inner"><span>clear-registry!</span></div></a></li><li class="depth-1"><a href="shiftlefter.stepengine.registry.html#var-defstep"><div class="inner"><span>defstep</span></div></a></li><li class="depth-1"><a href="shiftlefter.stepengine.registry.html#var-find-by-pattern"><div class="inner"><span>find-by-pattern</span></div></a></li><li class="depth-1"><a href="shiftlefter.stepengine.registry.html#var-register.21"><div class="inner"><span>register!</span></div></a></li></ul></div><div class="namespace-docs" id="content"><h1 class="anchor" id="top">shiftlefter.stepengine.registry</h1><div class="doc"><div class="markdown"><p>Step definition registry for ShiftLefter runner.</p>
<h2><a href="#stepdef-map-shape" id="stepdef-map-shape"></a>Stepdef Map Shape</h2>
<p>Each registered step definition is stored as:</p>
<pre><code class="language-clojure">{:stepdef/id "sd-abc123..."     ;; deterministic, stable across runs
 :pattern #"regex"               ;; compiled Pattern
 :pattern-src "regex"            ;; string form for display/matching
 :source {:ns 'my.steps :file "my/steps.clj" :line 42}
 :arity 2                         ;; non-variadic only
 :fn #function
 :metadata {:interface :web       ;; optional, nil for legacy steps
            :svo {:subject :$1 :verb :click :object :$2}}}
</code></pre>
<h2><a href="#registry-storage" id="registry-storage"></a>Registry Storage</h2>
<p>Keyed by pattern signature (pattern-src + flags) to detect duplicates even when Pattern objects are distinct instances.</p>
<h2><a href="#usage" id="usage"></a>Usage</h2>
<pre><code class="language-clojure">(register! #"I have (\d+) items"
           (fn [count-str] (Integer/parseInt count-str))
           {:ns 'my.steps :file "steps.clj" :line 10})

(all-stepdefs)  ;=&gt; seq of stepdef maps
(clear-registry!)  ;; for test isolation
</code></pre>
</div></div><div class="public anchor" id="var-all-stepdefs"><h3>all-stepdefs</h3><div class="usage"><code>(all-stepdefs)</code></div><div class="doc"><div class="markdown"><p>Return all registered step definitions as a seq of stepdef maps.</p>
</div></div><div class="src-link"><a href="https://github.com/SHIFT-LEFTER/shiftlefter/blob/v0.3.6-SNAPSHOT/src/shiftlefter/stepengine/registry.clj#L177">view source</a></div></div><div class="public anchor" id="var-clear-registry.21"><h3>clear-registry!</h3><div class="usage"><code>(clear-registry!)</code></div><div class="doc"><div class="markdown"><p>Clear all registered step definitions. Use for test isolation.</p>
</div></div><div class="src-link"><a href="https://github.com/SHIFT-LEFTER/shiftlefter/blob/v0.3.6-SNAPSHOT/src/shiftlefter/stepengine/registry.clj#L171">view source</a></div></div><div class="public anchor" id="var-defstep"><h3>defstep</h3><h4 class="type">macro</h4><div class="usage"><code>(defstep pattern second-arg &amp; rest-args)</code></div><div class="doc"><div class="markdown"><p>Define and register a step definition.</p>
<h2><a href="#basic-usage-ctx-first" id="basic-usage-ctx-first"></a>Basic Usage (ctx-first)</h2>
<p>Step functions that need accumulated state take ctx as FIRST argument:</p>
<pre><code class="language-clojure">(defstep #"I have (\d+) cucumbers" [ctx n]
  (assoc ctx :cucumbers (parse-long n)))

(defstep #"I eat (\d+)" [ctx n]
  (update ctx :cucumbers - (parse-long n)))

(defstep #"I should have (\d+) cucumbers" [ctx n]
  (assert (= (:cucumbers ctx) (parse-long n)))
  ctx)
</code></pre>
<h2><a href="#without-ctx-captures-only" id="without-ctx-captures-only"></a>Without ctx (captures only)</h2>
<p>Steps that don’t need accumulated state can omit ctx:</p>
<pre><code class="language-clojure">(defstep #"I print hello" []
  (println "hello"))  ;; returns nil, ctx unchanged
</code></pre>
<h2><a href="#datatable-docstring-access" id="datatable-docstring-access"></a>DataTable / DocString Access</h2>
<p>Use the <code>shiftlefter.step</code> helpers to access step arguments:</p>
<pre><code class="language-clojure">(require '[shiftlefter.step :as step])

(defstep #"the following users exist:" [ctx]
  (when-let [table (step/arguments ctx)]
    (doseq [[name email] (rest (:rows table))]
      (create-user! name email)))
  ctx)
</code></pre>
<h2><a href="#with-svo-metadata" id="with-svo-metadata"></a>With SVO Metadata</h2>
<p>For Shifted mode with subject/verb/object validation:</p>
<pre><code class="language-clojure">(defstep #"(.*) clicks (.*)"
  {:interface :web
   :svo {:subject :$1 :verb :click :object :$2}}
  [ctx subject target]
  (click target)
  ctx)
</code></pre>
<p>Metadata keys: - :interface — which interface this step uses (e.g., :web, :api) - :svo — subject/verb/object extraction map with :$1, :$2 placeholders</p>
<p>The macro captures source location automatically.</p>
</div></div><div class="src-link"><a href="https://github.com/SHIFT-LEFTER/shiftlefter/blob/v0.3.6-SNAPSHOT/src/shiftlefter/stepengine/registry.clj#L191">view source</a></div></div><div class="public anchor" id="var-find-by-pattern"><h3>find-by-pattern</h3><div class="usage"><code>(find-by-pattern pattern-src)</code></div><div class="doc"><div class="markdown"><p>Find a stepdef by its pattern source string. Returns nil if not found.</p>
</div></div><div class="src-link"><a href="https://github.com/SHIFT-LEFTER/shiftlefter/blob/v0.3.6-SNAPSHOT/src/shiftlefter/stepengine/registry.clj#L182">view source</a></div></div><div class="public anchor" id="var-register.21"><h3>register!</h3><div class="usage"><code>(register! pattern f source)</code><code>(register! pattern f source metadata)</code></div><div class="doc"><div class="markdown"><p>Register a step definition.</p>
<p>Parameters: - pattern: compiled regex Pattern - f: step function (must be non-variadic) - source: map with :ns, :file, :line (and optionally :var) - metadata: optional map with :interface and :svo keys</p>
<p>Throws on: - Duplicate pattern (same pattern-sig already registered) - Variadic function</p>
<p>Returns the stepdef map.</p>
</div></div><div class="src-link"><a href="https://github.com/SHIFT-LEFTER/shiftlefter/blob/v0.3.6-SNAPSHOT/src/shiftlefter/stepengine/registry.clj#L120">view source</a></div></div></div></body></html>