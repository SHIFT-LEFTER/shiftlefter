#!/usr/bin/env bash
# ShiftLefter CLI launcher (standalone release)
#
# This script runs shiftlefter.jar from the same directory.
# Requires Java 11 or later.

SCRIPT_DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)"
JAR_FILE="$SCRIPT_DIR/shiftlefter.jar"

# Check jar exists
if [[ ! -f "$JAR_FILE" ]]; then
    echo "Error: shiftlefter.jar not found in $SCRIPT_DIR" >&2
    echo "Make sure you're running from the extracted release directory." >&2
    exit 1
fi

# Find Java executable
find_java() {
    # 1. Check JAVA_HOME
    if [[ -n "${JAVA_HOME:-}" ]] && [[ -x "$JAVA_HOME/bin/java" ]]; then
        echo "$JAVA_HOME/bin/java"
        return
    fi
    # 2. Check macOS java_home helper
    if [[ -x /usr/libexec/java_home ]] && /usr/libexec/java_home &>/dev/null 2>&1; then
        echo "$(/usr/libexec/java_home)/bin/java"
        return
    fi
    # 3. Check Homebrew locations (macOS)
    for dir in /opt/homebrew/opt/openjdk/bin /usr/local/opt/openjdk/bin; do
        if [[ -x "$dir/java" ]]; then
            echo "$dir/java"
            return
        fi
    done
    # 4. Check PATH (but verify it actually works)
    if command -v java &>/dev/null; then
        if java -version &>/dev/null 2>&1; then
            echo "java"
            return
        fi
    fi
    echo ""
}

JAVA_CMD=$(find_java)

if [[ -z "$JAVA_CMD" ]]; then
    echo "Error: Java not found." >&2
    echo "Please install Java 11 or later and ensure it's in your PATH." >&2
    echo "  - macOS: brew install openjdk" >&2
    echo "  - Ubuntu: sudo apt install openjdk-11-jdk" >&2
    exit 1
fi

exec "$JAVA_CMD" -jar "$JAR_FILE" "$@"
